# Production Configuration for Strategiz Console API
#
# Active profiles (set via SPRING_PROFILES_ACTIVE environment variable in Dockerfile):
# - prod: Production settings (Vault, Firebase, etc.)
# - scheduler: Batch job beans for dynamic scheduling
#
# Note: Do NOT set spring.profiles.active or spring.profiles.include here.
# Spring Boot 3 does not allow profile activation from profile-specific files.

# Server Configuration
server.port=${PORT:8080}
server.ssl.enabled=false
https.enabled=false

# Enable PASETO authorization framework for consistent session management with main API
# AdminAuthInterceptor provides additional admin role validation on top of this
strategiz.authorization.enabled=true

# Security
server.servlet.session.cookie.secure=true
server.servlet.session.cookie.same-site=None

# Custom Cookie Configuration for cross-origin AJAX with credentials
app.cookie.secure=true
app.cookie.same-site=None
app.cookie.domain=strategiz.io

# Firebase Configuration
firebase.database-url=${FIREBASE_DATABASE_URL:https://strategiz-io.firebaseio.com}
firebase.project-id=${FIREBASE_PROJECT_ID:strategiz-io}
firebase.service-account-key=${FIREBASE_SERVICE_ACCOUNT_KEY}
firebase.storage.bucket=${FIREBASE_STORAGE_BUCKET:strategiz-io.firebasestorage.app}

# Enable Vault in production for centralized secret management
strategiz.vault.enabled=true
strategiz.vault.address=${STRATEGIZ_VAULT_ADDRESS:${VAULT_ADDR:https://strategiz-vault-43628135674.us-east1.run.app}}
strategiz.vault.cache-timeout-ms=60000
strategiz.vault.fail-fast=true
strategiz.vault.secrets-path=secret

# Spring Cloud Vault configuration
spring.cloud.vault.uri=${VAULT_ADDR:https://strategiz-vault-43628135674.us-east1.run.app}
spring.cloud.vault.token=${VAULT_TOKEN:}
spring.cloud.vault.kv.enabled=true
spring.cloud.vault.kv.backend=secret
spring.cloud.vault.kv.default-context=strategiz

# CORS Configuration - Console frontend only
strategiz.cors.allowed-origins=https://console.strategiz.io,https://strategiz-console.web.app

# Logging
logging.level.root=INFO
logging.level.io.strategiz=INFO
logging.level.org.springframework.web=INFO

# Actuator endpoints for health checks and observability
management.endpoints.web.exposure.include=health,info,prometheus,metrics
management.endpoint.health.show-details=when-authorized
# Disable Vault health indicator - secrets are loaded at startup, ongoing health check not needed
management.health.vault.enabled=false
management.endpoint.prometheus.enabled=true
management.metrics.export.prometheus.enabled=true
management.metrics.tags.application=strategiz-console

# Grafana Cloud OpenTelemetry Configuration
otel.exporter.otlp.endpoint=${GRAFANA_OTLP_ENDPOINT:https://otlp-gateway-prod-us-east-3.grafana.net/otlp}
otel.exporter.otlp.protocol=http/protobuf
otel.exporter.otlp.headers=Authorization=Basic ${GRAFANA_OTLP_AUTH_HEADER:}
otel.service.name=strategiz-console
otel.resource.attributes=service.namespace=strategiz,deployment.environment=production,service.version=1.0.0
otel.traces.exporter=otlp
otel.traces.sampler=parentbased_traceidratio
otel.traces.sampler.arg=${OTEL_SAMPLING_RATIO:0.1}
otel.metrics.exporter=otlp
otel.logs.exporter=otlp
otel.propagators=tracecontext,baggage

# Grafana Prometheus Query API
grafana.prometheus.url=${GRAFANA_PROMETHEUS_URL:https://prometheus-prod-66-prod-us-east-3.grafana.net/api/prom}
grafana.prometheus.auth=${GRAFANA_PROMETHEUS_AUTH:}

# Micrometer tracing configuration
management.tracing.enabled=true
management.tracing.sampling.probability=${OTEL_SAMPLING_RATIO:0.1}
management.tracing.propagation.type=W3C

# Enable histogram metrics
management.metrics.distribution.percentiles-histogram.http.server.requests=true
management.metrics.distribution.slo.http.server.requests=50ms,100ms,200ms,500ms,1s,5s

# Application info
info.app.name=Strategiz Console API
info.app.version=@project.version@
info.app.environment=production

# Disable development features
spring.devtools.enabled=false
spring.jpa.show-sql=false

# Bean definition overriding
spring.main.allow-bean-definition-overriding=true

# Cache Configuration
spring.cache.type=jcache
spring.cache.jcache.config=classpath:ehcache.xml

# Performance optimizations
spring.jackson.serialization.write-dates-as-timestamps=false
spring.jackson.default-property-inclusion=non_null

# ====================================================
# Market Data Batch Jobs (Production) - HIGH THROUGHPUT CONFIG
# ====================================================
# Optimized for S&P 500 full backfill (503 stocks x 9 timeframes x 7 years)
# Backfill job - disabled by default, triggered manually from console
marketdata.batch.backfill-enabled=false
marketdata.batch.backfill-years=7
# 5 timeframes (30Min, 1Hour, 1Day, 1Week, 1Month)
marketdata.batch.backfill-timeframes=30Min,1H,1D,1W,1M
# High-throughput: 40 concurrent symbols for fast backfill (2x increase)
marketdata.batch.thread-pool-size=40
# Large batches for efficient DB writes (doubled for better throughput)
marketdata.batch.batch-size=1000
# Extended timeout for full S&P 500 backfill (12 hours)
marketdata.batch.backfill-timeout-minutes=720

# Incremental job - runs every 5 minutes during market hours
marketdata.batch.incremental-enabled=true
marketdata.batch.incremental-cron=0 */5 * * * MON-FRI
marketdata.batch.incremental-lookback-hours=2

# ====================================================
# ClickHouse Cloud Configuration (market data storage)
# ====================================================
# Replaces TimescaleDB - 10-100x faster queries, 10-20x better compression
# Credentials loaded from Vault: secret/strategiz/clickhouse
# Required secrets: host, port, database, username, password
strategiz.clickhouse.enabled=true
strategiz.clickhouse.ssl=true
# Increased pool for high-throughput batch processing (40 threads + overhead)
strategiz.clickhouse.pool.max-pool-size=50
strategiz.clickhouse.pool.min-idle=5
# 60s timeout for ClickHouse Cloud initial connection
strategiz.clickhouse.pool.connection-timeout-ms=60000
strategiz.clickhouse.pool.idle-timeout-ms=300000

# ====================================================
# TimescaleDB Configuration (DISABLED - migrated to ClickHouse)
# ====================================================
strategiz.timescale.enabled=false

# ====================================================
# GCP Billing / Costs Dashboard (Production)
# ====================================================
gcp.billing.enabled=true
gcp.billing.demo-mode=false
gcp.billing.use-bigquery=true
gcp.billing.dataset=billing_export
gcp.billing.table=gcp_billing_export_v1_01DCCE_802D60_59D6B8

# ====================================================
# AI / LLM Billing (Production)
# ====================================================
ai.billing.enabled=true
llm.billing.enabled=true

# ====================================================
# ClickHouse Billing (Production)
# ====================================================
clickhouse.billing.enabled=true

# Passkey Configuration (not needed for console but keeps compatibility)
passkey.rpId=strategiz.io
passkey.rpName=Strategiz
passkey.challengeTimeoutMs=60000

# ====================================================
# Fundamentals Provider Configuration (Production)
# ====================================================
fundamentals.provider=fmp

# Financial Modeling Prep (FMP) Configuration
strategiz.fmp.enabled=true
fmp.api-key=O2X0agWv8mK2vtuN7sHfDbs9Lxw02UOR
fmp.base-url=https://financialmodelingprep.com/api/v3
fmp.rate-limit-per-minute=300
fmp.max-retries=3
fmp.retry-delay-ms=1000

# ====================================================
# Fixed Subscription Costs (Production)
# ====================================================
subscriptions.claude.enabled=true
subscriptions.claude.name=Claude Pro
subscriptions.claude.monthly-cost=200.00

subscriptions.fmp.enabled=true
subscriptions.fmp.name=FMP (Financial Modeling Prep)
subscriptions.fmp.monthly-cost=79.00

# ====================================================
# Stripe Billing (Production)
# ====================================================
stripe.billing.enabled=true
