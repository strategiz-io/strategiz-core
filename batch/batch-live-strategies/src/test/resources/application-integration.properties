# ====================================================
# Integration Test Configuration
# ====================================================
# Run with: -Dspring.profiles.active=integration
#
# Prerequisites:
# 1. gcloud auth application-default login
# 2. vault server -dev && export VAULT_TOKEN=root
# 3. Load secrets into Vault from your load-secrets.sh

spring.application.name=batch-live-strategies-test

# ====================================================
# Firebase Configuration (Dev)
# ====================================================
firebase.database-url=https://strategiz-io.firebaseio.com
firebase.project-id=strategiz-io
firebase.credentials.path=${FIREBASE_CREDENTIALS_PATH:}
firebase.storage.bucket=strategiz-io.firebasestorage.app

# ====================================================
# Vault Configuration (Local Dev Vault)
# ====================================================
strategiz.vault.enabled=true
strategiz.vault.address=http://localhost:8200
strategiz.vault.secrets-path=secret
strategiz.vault.fail-fast=true
strategiz.vault.fallback-to-properties=false

spring.cloud.vault.authentication=TOKEN
spring.cloud.vault.uri=http://localhost:8200
spring.cloud.vault.token=${VAULT_TOKEN:root}
spring.cloud.vault.kv.enabled=true
spring.cloud.vault.kv.backend=secret
spring.cloud.vault.kv.default-context=strategiz

# ====================================================
# TimescaleDB Configuration (Real Database via Vault)
# ====================================================
# Credentials loaded from Vault: secret/strategiz/timescale
strategiz.timescale.enabled=true
strategiz.timescale.hikari.minimum-idle=2
strategiz.timescale.hikari.maximum-pool-size=5
strategiz.timescale.hikari.connection-timeout-ms=30000
strategiz.timescale.hikari.idle-timeout-ms=300000
strategiz.timescale.hikari.max-lifetime-ms=1800000

# ====================================================
# Live Strategies Dispatch Configuration
# ====================================================
live-strategies.dispatch.enabled=true
live-strategies.market-data.lookback-days=365
live-strategies.execution.timeout-seconds=30

# ====================================================
# gRPC Execution Service
# ====================================================
strategiz.execution.service.host=${GRPC_EXECUTION_HOST:localhost}
strategiz.execution.service.port=${GRPC_EXECUTION_PORT:50051}
strategiz.execution.service.use-tls=false

# ====================================================
# Pub/Sub Configuration (Dev)
# ====================================================
spring.cloud.gcp.project-id=strategiz-io
spring.cloud.gcp.pubsub.enabled=true
pubsub.deployment.topic=deployment-processing-dev

# ====================================================
# Alpaca Configuration (via Vault)
# ====================================================
# Credentials loaded from Vault: secret/strategiz/alpaca
alpaca.trading.base-url=https://paper-api.alpaca.markets
alpaca.data.base-url=https://data.alpaca.markets

# ====================================================
# Disable GCP Spring Cloud Auto-Config
# ====================================================
# We use Firebase Admin SDK directly, not Spring Cloud GCP
spring.cloud.gcp.firestore.enabled=false
spring.cloud.gcp.enabled=false
spring.cloud.gcp.core.enabled=false

# ====================================================
# Allow Bean Overriding
# ====================================================
spring.main.allow-bean-definition-overriding=true

# ====================================================
# Logging (Integration Tests - INFO)
# ====================================================
logging.level.root=INFO
logging.level.io.strategiz=DEBUG
logging.level.io.strategiz.batch.livestrategies=DEBUG
logging.level.io.strategiz.business.livestrategies=DEBUG
logging.level.org.springframework.boot.autoconfigure=WARN

