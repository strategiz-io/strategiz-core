# Production Configuration for Strategiz

# Server Configuration
server.port=${PORT:8080}
# Disable SSL - Cloud Run handles TLS termination at the load balancer
server.ssl.enabled=false
# Disable custom HTTPS connector (not needed in Cloud Run)
https.enabled=false

# Security
server.servlet.session.cookie.secure=true
server.servlet.session.cookie.same-site=None

# Custom Cookie Configuration for cross-origin AJAX with credentials
# Domain set to strategiz.io (browsers automatically apply to all subdomains)
# (api.strategiz.io, console.strategiz.io, auth.strategiz.io)
app.cookie.secure=true
app.cookie.same-site=None
app.cookie.domain=strategiz.io

# Firebase Configuration (from environment variables)
firebase.database-url=${FIREBASE_DATABASE_URL:https://strategiz-io.firebaseio.com}
firebase.project-id=${FIREBASE_PROJECT_ID:strategiz-io}
firebase.service-account-key=${FIREBASE_SERVICE_ACCOUNT_KEY}
firebase.storage.bucket=${FIREBASE_STORAGE_BUCKET:strategiz-io.firebasestorage.app}

# Enable Vault in production for centralized secret management
strategiz.vault.enabled=true
strategiz.vault.address=${STRATEGIZ_VAULT_ADDRESS:${VAULT_ADDR:https://strategiz-vault-43628135674.us-east1.run.app}}
strategiz.vault.cache-timeout-ms=60000
strategiz.vault.fail-fast=true
strategiz.vault.secrets-path=secret

# Spring Cloud Vault configuration for production
spring.cloud.vault.uri=${VAULT_ADDR:https://strategiz-vault-43628135674.us-east1.run.app}
spring.cloud.vault.token=${VAULT_TOKEN:}
spring.cloud.vault.kv.enabled=true
spring.cloud.vault.kv.backend=secret
spring.cloud.vault.kv.default-context=strategiz

# CORS Configuration
strategiz.cors.allowed-origins=https://strategiz-io.web.app,https://strategiz-io.firebaseapp.com,https://strategiz.io,https://console.strategiz.io,https://strategiz-console.web.app,https://auth.strategiz.io,https://strategiz-auth.web.app

# Logging
logging.level.root=INFO
logging.level.io.strategiz=INFO
logging.level.org.springframework.web=INFO
logging.level.org.springframework.security=INFO

# Actuator endpoints for health checks and observability
management.endpoints.web.exposure.include=health,info,prometheus,metrics
management.endpoint.health.show-details=when-authorized
management.endpoint.prometheus.enabled=true
management.metrics.export.prometheus.enabled=true
management.metrics.tags.application=strategiz-core

# ====================================================
# Grafana Cloud OpenTelemetry Configuration
# ====================================================
# OTLP Exporter - Grafana Cloud endpoints
# Get your instance details from: https://grafana.com/docs/grafana-cloud/monitor-infrastructure/otlp/
otel.exporter.otlp.endpoint=${GRAFANA_OTLP_ENDPOINT:https://otlp-gateway-prod-us-east-3.grafana.net/otlp}
otel.exporter.otlp.protocol=http/protobuf

# Authentication - Grafana Cloud uses Basic Auth
# Username = Instance ID, Password = API Token (stored in Vault)
otel.exporter.otlp.headers=Authorization=Basic ${GRAFANA_OTLP_AUTH_HEADER:}

# Service identification
otel.service.name=strategiz-core
otel.resource.attributes=service.namespace=strategiz,deployment.environment=production,service.version=1.0.0

# Tracing configuration - 10% sampling for production to reduce costs
otel.traces.exporter=otlp
otel.traces.sampler=parentbased_traceidratio
otel.traces.sampler.arg=${OTEL_SAMPLING_RATIO:0.1}

# Metrics configuration
otel.metrics.exporter=otlp

# Logging configuration
otel.logs.exporter=otlp

# Propagation context for distributed tracing
otel.propagators=tracecontext,baggage

# Grafana Prometheus Query API - for fetching metrics in console
# This is used by GrafanaMetricsClient to query stored metrics
grafana.prometheus.url=${GRAFANA_PROMETHEUS_URL:https://prometheus-prod-66-prod-us-east-3.grafana.net/api/prom}
grafana.prometheus.auth=${GRAFANA_PROMETHEUS_AUTH:}

# Micrometer tracing configuration
management.tracing.enabled=true
management.tracing.sampling.probability=${OTEL_SAMPLING_RATIO:0.1}
management.tracing.propagation.type=W3C

# Enable histogram metrics for percentile calculations
management.metrics.distribution.percentiles-histogram.http.server.requests=true
management.metrics.distribution.slo.http.server.requests=50ms,100ms,200ms,500ms,1s,5s

# Application info
info.app.name=Strategiz Core API
info.app.version=@project.version@
info.app.environment=production

# Frontend URL configuration
application.frontend-url=https://strategiz.io
frontend.url=https://strategiz.io

# OAuth Configuration for Authentication
# Auth portal is the centralized SSO provider for all Strategiz apps
oauth.frontend-url=https://auth.strategiz.io

# Passkey Configuration for Production
passkey.rpId=strategiz.io
passkey.rpName=Strategiz
passkey.challengeTimeoutMs=60000

# OAuth credentials loaded from Vault via OAuthVaultConfig
# Google OAuth Configuration (production)
oauth.providers.google.redirect-uri=https://api.strategiz.io/v1/auth/oauth/google/signin/callback
oauth.providers.google.signup-redirect-uri=https://api.strategiz.io/v1/auth/oauth/google/signup/callback
oauth.providers.google.auth-url=https://accounts.google.com/o/oauth2/auth
oauth.providers.google.token-url=https://oauth2.googleapis.com/token
oauth.providers.google.user-info-url=https://www.googleapis.com/oauth2/v3/userinfo
oauth.providers.google.scope=email profile openid

# Facebook OAuth Configuration (production)
oauth.providers.facebook.redirect-uri=https://api.strategiz.io/v1/auth/oauth/facebook/signin/callback
oauth.providers.facebook.signup-redirect-uri=https://api.strategiz.io/v1/auth/oauth/facebook/signup/callback
oauth.providers.facebook.auth-url=https://www.facebook.com/v12.0/dialog/oauth
oauth.providers.facebook.token-url=https://graph.facebook.com/v12.0/oauth/access_token
oauth.providers.facebook.user-info-url=https://graph.facebook.com/me
oauth.providers.facebook.scope=email,public_profile

# Coinbase OAuth Configuration (production) - for provider connections
oauth.providers.coinbase.redirect-uri=https://api.strategiz.io/v1/providers/callback/cb
oauth.providers.coinbase.auth-url=https://www.coinbase.com/oauth/authorize
oauth.providers.coinbase.scope=wallet:accounts:read,wallet:transactions:read,wallet:buys:read,wallet:sells:read

# Alpaca OAuth Configuration
oauth.providers.alpaca.redirect-uri=https://api.strategiz.io/v1/providers/callback/alpaca
oauth.providers.alpaca.auth-url=https://app.alpaca.markets/oauth/authorize
oauth.providers.alpaca.token-url=https://api.alpaca.markets/oauth/token
oauth.providers.alpaca.scope=account:read trading:write data:read

# Schwab OAuth Configuration
oauth.providers.schwab.redirect-uri=https://api.strategiz.io/v1/providers/callback/schwab

# Disable development features
spring.devtools.enabled=false
spring.jpa.show-sql=false

# Bean definition overriding (required for RestTemplate bean conflicts)
spring.main.allow-bean-definition-overriding=true

# OpenTelemetry enabled for metrics export to Grafana Cloud
# Configured via otel.* properties above (lines 57-95)

# Cache Configuration (Ehcache for market data caching)
spring.cache.type=jcache
spring.cache.jcache.config=classpath:ehcache.xml

# Performance optimizations
spring.jackson.serialization.write-dates-as-timestamps=false
spring.jackson.default-property-inclusion=non_null

# Gemini AI Configuration (legacy - deprecated)
gemini.api.url=https://generativelanguage.googleapis.com
gemini.model=gemini-2.0-flash-exp
gemini.temperature=0.7
gemini.max-tokens=2048

# ====================================================
# Google Vertex AI Configuration
# ====================================================
# All LLM providers (Gemini, Claude, OpenAI, Llama, Mistral, Cohere) use Vertex AI
# Authentication via Application Default Credentials (ADC)
vertex.ai.project-id=43628135674
vertex.ai.location=us-east1

# Gemini Vertex AI
gemini.vertex.project-id=${vertex.ai.project-id}
gemini.vertex.location=${vertex.ai.location}
gemini.vertex.model=gemini-2.5-flash
gemini.vertex.temperature=0.7
gemini.vertex.max-tokens=8192
gemini.vertex.enabled=true

# Claude Vertex AI
claude.vertex.project-id=${vertex.ai.project-id}
claude.vertex.location=${vertex.ai.location}
claude.vertex.model=claude-haiku-4-5
claude.vertex.temperature=0.7
claude.vertex.max-tokens=8192
claude.vertex.enabled=true

# OpenAI Vertex AI
openai.vertex.project-id=${vertex.ai.project-id}
openai.vertex.location=${vertex.ai.location}
openai.vertex.model=gpt-4o-mini
openai.vertex.temperature=0.7
openai.vertex.max-tokens=8192
openai.vertex.enabled=true

# Llama Vertex AI (Meta)
llama.vertex.project-id=${vertex.ai.project-id}
llama.vertex.location=${vertex.ai.location}
llama.vertex.model=llama-3.1-8b-instruct-maas
llama.vertex.temperature=0.7
llama.vertex.max-tokens=8192
llama.vertex.enabled=true

# Mistral Vertex AI
mistral.vertex.project-id=${vertex.ai.project-id}
mistral.vertex.location=${vertex.ai.location}
mistral.vertex.model=mistral-nemo
mistral.vertex.temperature=0.7
mistral.vertex.max-tokens=8192
mistral.vertex.enabled=true

# Cohere Vertex AI
cohere.vertex.project-id=${vertex.ai.project-id}
cohere.vertex.location=${vertex.ai.location}
cohere.vertex.model=command-r
cohere.vertex.temperature=0.7
cohere.vertex.max-tokens=8192
cohere.vertex.enabled=true

# Anthropic Direct API (Claude 4.5 models)
anthropic.direct.api-url=https://api.anthropic.com
anthropic.direct.model=claude-opus-4-5-20251101
anthropic.direct.temperature=0.7
anthropic.direct.max-tokens=8192
anthropic.direct.timeout-seconds=60
anthropic.direct.enabled=true

# xAI Direct API (Grok 4.1 models - Nov 2025)
grok.direct.api-url=https://api.x.ai
grok.direct.model=grok-4.1-fast
grok.direct.temperature=0.7
grok.direct.max-tokens=8192
grok.direct.timeout-seconds=60
grok.direct.enabled=true

# OpenAI Direct API (GPT-4o, o1 models)
openai.direct.api-url=https://api.openai.com
openai.direct.model=gpt-4o
openai.direct.temperature=0.7
openai.direct.max-tokens=8192
openai.direct.timeout-seconds=60
openai.direct.enabled=true

# ====================================================
# Market Data Batch Jobs (Production)
# ====================================================
# Backfill job - disabled by default, triggered manually from console
marketdata.batch.backfill-enabled=false
marketdata.batch.backfill-years=7
marketdata.batch.backfill-timeframes=1Day,1Hour,1Week,1Month
marketdata.batch.thread-pool-size=1
marketdata.batch.batch-size=100
marketdata.batch.backfill-timeout-minutes=480

# Incremental job - runs every 5 minutes during market hours
marketdata.batch.incremental-enabled=false
marketdata.batch.incremental-cron=0 */5 * * * MON-FRI
marketdata.batch.incremental-lookback-hours=2

# TimescaleDB Configuration (market data storage)
strategiz.timescale.enabled=true
# Credentials loaded from Vault: secret/strategiz/timescale
# jdbc-url, username, password
strategiz.timescale.hikari.minimum-idle=2
strategiz.timescale.hikari.maximum-pool-size=20
strategiz.timescale.hikari.connection-timeout-ms=10000
strategiz.timescale.hikari.idle-timeout-ms=300000
strategiz.timescale.hikari.max-lifetime-ms=1800000
# Leak detection threshold - log warnings if connections held > 60s
strategiz.timescale.hikari.leak-detection-threshold=60000

# Stripe Payment Configuration
# Credentials loaded from Vault: secret/strategiz/stripe
# Required secrets: api-secret-key, api-publishable-key, webhook-secret, price-trader, price-strategist
app.base-url=https://strategiz.io
stripe.api.secret-key=${STRIPE_SECRET_KEY:}
stripe.api.publishable-key=${STRIPE_PUBLISHABLE_KEY:}
stripe.webhook.secret=${STRIPE_WEBHOOK_SECRET:}
stripe.price.trader=${STRIPE_PRICE_TRADER:}
stripe.price.strategist=${STRIPE_PRICE_STRATEGIST:}

# ====================================================
# Robinhood Provider Configuration
# ====================================================
# Note: This uses an unofficial API. No OAuth available for third parties.
# Credentials stored in Vault: secret/strategiz/robinhood
robinhood.enabled=true
robinhood.api.url=https://api.robinhood.com
robinhood.client-id=${ROBINHOOD_CLIENT_ID:c82SH0WZOsabOXGP2sxqcj34FxkvfnWRZBKlBjFS}

# ====================================================
# Plaid Configuration
# ====================================================
# Controlled by feature flag (plaid_enabled in Firestore)
# Credentials loaded from Vault: secret/strategiz/plaid
# Required secrets: client-id, secret
plaid.enabled=false
plaid.environment=production
plaid.redirect-uri=https://api.strategiz.io/v1/providers/plaid/oauth-callback

# ====================================================
# GCP Billing / Costs Dashboard (Production)
# ====================================================
# Enabled with fixed Vault credentials path and optional AI costs service
gcp.billing.enabled=true
gcp.billing.demo-mode=false
# Credentials loaded from Vault: secret/strategiz/gcp-billing
# Required secrets: project-id, billing-account-id, credentials (raw JSON service account key)

# AI Billing / Costs Tracking (Production)
# Temporarily disabled to isolate GCP billing issue
ai.billing.enabled=false
# Credentials loaded from Vault: secret/strategiz/anthropic, secret/strategiz/openai, secret/strategiz/xai
# ====================================================
# Python Strategy Execution Service (gRPC)
# ====================================================
# Production Cloud Run service
strategiz.execution.service.host=strategiz-execution-43628135674.us-east1.run.app
strategiz.execution.service.port=443
strategiz.execution.service.use-tls=true

# GitHub API Configuration (for Platform Agents)
github.token=${GITHUB_TOKEN:}
