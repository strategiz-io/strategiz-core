# ====================================================
# Development Configuration for Strategiz
# ====================================================
# Run with: -Dspring.profiles.active=dev

spring.application.name=strategiz-core

# ====================================================
# Server Configuration (HTTPS)
# ====================================================
server.port=8443
server.ssl.enabled=true
server.ssl.key-store-type=PKCS12
server.ssl.key-store=classpath:ssl/keystore.p12
server.ssl.key-store-password=strategiz
server.ssl.key-alias=1

# ====================================================
# Firebase Configuration
# ====================================================
firebase.database-url=https://strategiz-io.firebaseio.com
firebase.project-id=strategiz-io
firebase.credentials.path=${FIREBASE_CREDENTIALS_PATH:src/main/resources/firebase-service-account.json}
firebase.storage.bucket=strategiz-io.firebasestorage.app

# ====================================================
# Vault Configuration
# ====================================================
strategiz.vault.enabled=true
strategiz.vault.address=http://localhost:8200
strategiz.vault.secrets-path=secret
strategiz.vault.fail-fast=true
strategiz.vault.fallback-to-properties=false

spring.cloud.vault.authentication=TOKEN
spring.cloud.vault.uri=http://localhost:8200
spring.cloud.vault.token=${VAULT_TOKEN:root}
spring.cloud.vault.kv.enabled=true
spring.cloud.vault.kv.backend=secret
spring.cloud.vault.kv.default-context=strategiz

# ====================================================
# CORS Configuration
# ====================================================
strategiz.cors.allowed-origins=http://localhost:3000,http://localhost:3001,http://localhost:3002,https://localhost:3000,https://localhost:3001,https://localhost:3002,https://localhost:8443

# ====================================================
# Frontend URL Configuration
# ====================================================
application.frontend-url=http://localhost:3000
frontend.url=http://localhost:3000
# Auth portal handles all OAuth callbacks in development
oauth.frontend-url=http://localhost:3002

# ====================================================
# Cookie Configuration
# ====================================================
app.cookie.secure=true
app.cookie.domain=localhost
app.cookie.access-token-max-age=1800
app.cookie.refresh-token-max-age=604800
app.cookie.same-site=Lax

# ====================================================
# SMS OTP Configuration
# ====================================================
strategiz.auth.sms-otp.enabled=true
strategiz.auth.sms-otp.dev-mock-sms-enabled=false
strategiz.auth.sms-otp.firebase-enabled=false

# ====================================================
# Passkey Configuration
# ====================================================
passkey.rpId=localhost
passkey.rpName=Strategiz Dev
passkey.challengeTimeoutMs=60000

# ====================================================
# Session Management
# ====================================================
session.expiry.seconds=86400
session.management.enabled=true
session.cleanup.expired.days=7
session.cleanup.revoked.days=1

# ====================================================
# Authentication OAuth (Google, Facebook)
# ====================================================
oauth.providers.google.redirect-uri=https://localhost:8443/v1/auth/oauth/google/signin/callback
oauth.providers.google.signup-redirect-uri=https://localhost:8443/v1/auth/oauth/google/signup/callback
oauth.providers.google.auth-url=https://accounts.google.com/o/oauth2/auth
oauth.providers.google.token-url=https://oauth2.googleapis.com/token
oauth.providers.google.user-info-url=https://www.googleapis.com/oauth2/v3/userinfo
oauth.providers.google.scope=email profile openid

oauth.providers.facebook.redirect-uri=https://localhost:8443/v1/auth/oauth/facebook/signin/callback
oauth.providers.facebook.signup-redirect-uri=https://localhost:8443/v1/auth/oauth/facebook/signup/callback
oauth.providers.facebook.auth-url=https://www.facebook.com/v12.0/dialog/oauth
oauth.providers.facebook.token-url=https://graph.facebook.com/v12.0/oauth/access_token
oauth.providers.facebook.user-info-url=https://graph.facebook.com/me
oauth.providers.facebook.scope=email,public_profile

# ====================================================
# Provider OAuth (Coinbase, Alpaca, Schwab, Kraken)
# ====================================================
oauth.providers.coinbase.redirect-uri=https://localhost:8443/v1/providers/callback/cb
oauth.providers.coinbase.auth-url=https://www.coinbase.com/oauth/authorize
oauth.providers.coinbase.scope=wallet:accounts:read,wallet:transactions:read,wallet:buys:read,wallet:sells:read

oauth.providers.alpaca.redirect-uri=https://localhost:8443/v1/providers/callback/alpaca
oauth.providers.alpaca.auth-url=https://app.alpaca.markets/oauth/authorize
oauth.providers.alpaca.token-url=https://api.alpaca.markets/oauth/token
oauth.providers.alpaca.api-url=https://api.alpaca.markets
oauth.providers.alpaca.scope=account:read trading:write data:read

oauth.providers.schwab.redirect-uri=https://127.0.0.1:8443/v1/providers/callback/schwab
oauth.providers.schwab.auth-url=https://api.schwabapi.com/v1/oauth/authorize
oauth.providers.schwab.token-url=https://api.schwabapi.com/v1/oauth/token
oauth.providers.schwab.api-url=https://api.schwabapi.com
oauth.providers.schwab.scope=readonly

oauth.providers.kraken.redirect-uri=https://localhost:8443/v1/providers/callback/kraken

# ====================================================
# Provider API URLs
# ====================================================
provider.kraken.api.url=https://api.kraken.com
provider.coinbase.api.url=https://api.coinbase.com/v2
provider.coingecko.api.url=https://api.coingecko.com/api/v3
provider.alphavantage.api.url=https://www.alphavantage.co
alphavantage.api.key=demo
alphavantage.enabled=false

# ====================================================
# Finnhub API Configuration
# ====================================================
# Credentials loaded from Vault: secret/strategiz/finnhub
finnhub.api.key=${FINNHUB_API_KEY:}
finnhub.api.base-url=https://finnhub.io/api/v1
finnhub.api.rate-limit=60

robinhood.client-id=${ROBINHOOD_CLIENT_ID:c82SH0WZOsabOXGP2sxqcj34FxkvfnWRZBKlBjFS}
robinhood.api.url=https://api.robinhood.com
robinhood.enabled=true

# ====================================================
# Plaid Configuration (disabled by default - enable via feature flag)
# ====================================================
plaid.enabled=false
plaid.environment=sandbox
plaid.redirect-uri=https://localhost:8443/v1/providers/plaid/oauth-callback
# Credentials loaded from Vault: secret/strategiz/plaid (client-id, secret)

# ====================================================
# Polygon.io Market Data
# ====================================================
polygon.api.key=${POLYGON_API_KEY:}
polygon.api.base-url=https://api.polygon.io
polygon.api.timeout.connect=5000
polygon.api.timeout.read=30000
polygon.api.rate-limit.per-minute=5
polygon.api.rate-limit.per-day=100
polygon.batch.enabled=true
polygon.batch.cron=0 0 2,14 * * ?
polygon.batch.timezone=America/New_York
polygon.batch.symbols.max=45

# ====================================================
# Yahoo Finance Batch Collection
# ====================================================
yahoo.batch.enabled=true
yahoo.batch.cron=0 0 3 * * ?
yahoo.batch.timezone=America/New_York
yahoo.batch.symbols.max=170
yahoo.batch.backfill-years=7
yahoo.batch.delay-ms=100
yahoo.batch.incremental=true

# ====================================================
# Market Data Storage
# ====================================================
marketdata.retention.days=2555
marketdata.compression.enabled=true
marketdata.auto-cleanup=true

# ====================================================
# Market Data Batch Jobs
# ====================================================
# Backfill job (manual trigger only in dev)
marketdata.batch.backfill-enabled=false
marketdata.batch.backfill-years=7
marketdata.batch.backfill-timeframes=1Day,1Hour,1Week,1Month
marketdata.batch.thread-pool-size=10
marketdata.batch.batch-size=500
marketdata.batch.backfill-timeout-minutes=480

# Incremental job (disabled in dev, manual trigger only)
marketdata.batch.incremental-enabled=false
marketdata.batch.incremental-cron=0 */5 * * * MON-FRI
marketdata.batch.incremental-lookback-hours=2

# ====================================================
# ClickHouse Cloud Configuration (market data storage)
# ====================================================
# Credentials loaded from Vault: secret/strategiz/clickhouse
strategiz.clickhouse.enabled=true
strategiz.clickhouse.ssl=true
strategiz.clickhouse.pool.max-pool-size=5
strategiz.clickhouse.pool.min-idle=1
strategiz.clickhouse.pool.connection-timeout-ms=10000
strategiz.clickhouse.pool.idle-timeout-ms=300000

# TimescaleDB Configuration (DISABLED - migrated to ClickHouse)
strategiz.timescale.enabled=false
strategiz.timescale.hikari.minimum-idle=4
strategiz.timescale.hikari.maximum-pool-size=20
strategiz.timescale.hikari.connection-timeout-ms=30000
strategiz.timescale.hikari.idle-timeout-ms=300000
strategiz.timescale.hikari.max-lifetime-ms=1800000
strategiz.timescale.hikari.leak-detection-threshold-ms=180000
strategiz.timescale.hikari.keepalive-time-ms=30000

# ====================================================
# Gemini AI Configuration
# ====================================================
gemini.api.url=https://generativelanguage.googleapis.com
gemini.model=gemini-1.5-flash
gemini.temperature=0.7
gemini.max-tokens=2048

# ====================================================
# Cache Configuration
# ====================================================
spring.cache.type=jcache
spring.cache.jcache.config=classpath:ehcache.xml

# ====================================================
# Disable unused autoconfiguration
# ====================================================
# Disable JPA/DataSource (we use Firebase Firestore, not JPA)
spring.jpa.enabled=false
spring.jpa.hibernate.ddl-auto=none
spring.jpa.properties.hibernate.validator.apply_to_ddl=false
spring.data.jpa.repositories.enabled=false
# Disable Spring Cloud GCP (we use Firebase Admin SDK directly)
spring.cloud.gcp.firestore.enabled=false
spring.cloud.gcp.enabled=false
spring.cloud.gcp.core.enabled=false
spring.autoconfigure.exclude=\
  org.springframework.boot.autoconfigure.jdbc.DataSourceAutoConfiguration,\
  org.springframework.boot.autoconfigure.orm.jpa.HibernateJpaAutoConfiguration,\
  org.springframework.boot.autoconfigure.jdbc.DataSourceTransactionManagerAutoConfiguration,\
  org.springframework.data.jpa.repository.config.JpaRepositoriesAutoConfiguration,\
  org.springframework.cloud.gcp.autoconfigure.core.GcpContextAutoConfiguration,\
  org.springframework.cloud.gcp.autoconfigure.firestore.GcpFirestoreAutoConfiguration,\
  org.springframework.boot.autoconfigure.batch.BatchAutoConfiguration,\
  org.springframework.boot.autoconfigure.data.rest.RepositoryRestMvcAutoConfiguration
spring.main.allow-bean-definition-overriding=true

# ====================================================
# Actuator & Metrics
# ====================================================
management.endpoints.web.exposure.include=*
management.endpoint.health.show-details=always
management.endpoint.health.show-components=always
management.endpoints.web.base-path=/actuator
management.endpoint.prometheus.enabled=true
management.metrics.export.prometheus.enabled=true
management.metrics.tags.application=strategiz-core
management.metrics.distribution.percentiles-histogram.http.server.requests=true
management.metrics.distribution.slo.http.server.requests=50ms, 100ms, 200ms, 500ms, 1s
management.metrics.web.client.request.autotime.enabled=true

# ====================================================
# Distributed Tracing
# ====================================================
management.tracing.enabled=true
management.tracing.sampling.probability=1.0
management.tracing.propagation.type=W3C
management.otlp.tracing.endpoint=http://localhost:4318/v1/traces

# ====================================================
# SpringDoc OpenAPI
# ====================================================
springdoc.api-docs.path=/v3/api-docs
springdoc.swagger-ui.path=/swagger-ui.html
springdoc.swagger-ui.operations-sorter=alpha
springdoc.swagger-ui.tags-sorter=alpha
springdoc.swagger-ui.display-request-duration=true
springdoc.swagger-ui.try-it-out-enabled=true
springdoc.packagesToScan=io.strategiz
springdoc.pathsToMatch=/v1/**

# ====================================================
# Authorization Framework
# ====================================================
strategiz.authorization.enabled=true

# ====================================================
# Spring MVC
# ====================================================
spring.mvc.throw-exception-if-no-handler-found=true
spring.web.resources.add-mappings=true
spring.mvc.static-path-pattern=/static/**

# ====================================================
# GCP Billing / Costs Dashboard (Demo Mode)
# ====================================================
gcp.billing.enabled=false
gcp.billing.demo-mode=true

# ====================================================
# Logging (Development - DEBUG)
# ====================================================
logging.level.root=INFO
logging.level.io.strategiz=DEBUG
logging.level.io.strategiz.application.config=DEBUG
logging.level.io.strategiz.service.auth=DEBUG
logging.level.org.springframework.web=DEBUG
logging.level.org.springframework.security=WARN
spring.devtools.enabled=true

# ====================================================
# Python Strategy Execution Service (gRPC)
# ====================================================
# For local development, run the Python service with:
# cd application-strategy-execution
# python -m strategiz_execution.server
strategiz.execution.service.host=localhost
strategiz.execution.service.port=50051
strategiz.execution.service.use-tls=false
