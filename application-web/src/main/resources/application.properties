spring.profiles.active=dev

# SMS OTP Configuration (Real SMS via Firebase)
strategiz.auth.sms-otp.enabled=true
strategiz.auth.sms-otp.dev-mock-sms-enabled=false
strategiz.auth.sms-otp.firebase-enabled=true

# Firebase Configuration
# Firebase provides 10,000 free SMS verifications per month
# Phone Authentication must be enabled in Firebase Console
firebase.credentials.path=${FIREBASE_CREDENTIALS_PATH:src/main/resources/firebase-service-account.json}
firebase.project.id=${FIREBASE_PROJECT_ID:strategiz-platform}

# Kraken Provider Configuration
provider.kraken.client-id=
provider.kraken.client-secret=
provider.kraken.api.url=https://api.kraken.com

# Binance.US Provider Configuration
provider.binanceus.client-id=
provider.binanceus.client-secret=

# Charles Schwab Provider Configuration (empty defaults, will be implemented separately)
provider.charlesschwab.client-id=
provider.charlesschwab.client-secret=

# Common OAuth Configuration
provider.oauth.redirect-uri=http://localhost:8080/api/v1/provider/callback

# Coinbase Provider Configuration
provider.coinbase.api.url=https://api.coinbase.com/v2

# CoinGecko Provider Configuration
provider.coingecko.api.url=https://api.coingecko.com/api/v3

# AlphaVantage Provider Configuration  
provider.alphavantage.api.url=https://www.alphavantage.co
# Note: Demo key has limited functionality - get real key at https://www.alphavantage.co/support/#api-key
alphavantage.api.key=demo
alphavantage.enabled=false
server.port=8443

# HTTPS Configuration for Charles Schwab OAuth callbacks
server.ssl.enabled=true
server.ssl.key-store-type=PKCS12
server.ssl.key-store=classpath:ssl/keystore.p12
server.ssl.key-store-password=strategiz
server.ssl.key-alias=1

# Additional HTTPS connector for port 8443 (configured via code)

# Cookie Configuration (Production)
app.cookie.secure=true
app.cookie.domain=.strategiz.io
app.cookie.access-token-max-age=1800
app.cookie.refresh-token-max-age=604800
server.additional.https.port=8443
server.additional.https.cert-path=cert.pem
server.additional.https.key-path=key.pem

# Polygon.io Market Data Configuration (DISABLED - using Yahoo Finance instead)
# Get your free API key at: https://polygon.io/dashboard/api-keys
polygon.api.key=${POLYGON_API_KEY:}
polygon.api.base-url=https://api.polygon.io
polygon.api.timeout.connect=5000
polygon.api.timeout.read=30000

# Rate limiting (Free tier: 5 calls/minute, 100 calls/day)
polygon.api.rate-limit.per-minute=5
polygon.api.rate-limit.per-day=100

# Batch Job Configuration - DISABLED Polygon, using Yahoo Finance
polygon.batch.enabled=false
polygon.batch.cron=0 0 2,14 * * ?
polygon.batch.timezone=America/New_York
polygon.batch.symbols.max=45

# Yahoo Finance Historical Data Collection (UNLIMITED - FREE)
yahoo.batch.enabled=true
yahoo.batch.cron=0 0 3 * * ?
yahoo.batch.timezone=America/New_York
yahoo.batch.symbols.max=170
yahoo.batch.backfill-years=7
yahoo.batch.delay-ms=100
yahoo.batch.incremental=true

# Market Data Storage
marketdata.retention.days=2555
marketdata.compression.enabled=true
marketdata.auto-cleanup=true

# Bean definition overriding
spring.main.allow-bean-definition-overriding=true

# Disable Spring Cloud GCP Firestore autoconfiguration since we're using Firebase Admin SDK
spring.cloud.gcp.firestore.enabled=false
spring.cloud.gcp.enabled=false
spring.cloud.gcp.core.enabled=false

# Disable JPA and Hibernate since we're using Firestore
spring.jpa.enabled=false
spring.autoconfigure.exclude=org.springframework.boot.autoconfigure.jdbc.DataSourceAutoConfiguration,org.springframework.boot.autoconfigure.orm.jpa.HibernateJpaAutoConfiguration,org.springframework.boot.autoconfigure.jdbc.DataSourceTransactionManagerAutoConfiguration,org.springframework.data.jpa.repository.config.JpaRepositoriesAutoConfiguration,org.springframework.cloud.gcp.autoconfigure.core.GcpContextAutoConfiguration,org.springframework.cloud.gcp.autoconfigure.firestore.GcpFirestoreAutoConfiguration

# Frontend URL configuration
application.frontend-url=http://localhost:3000

# OAuth Configuration for Authentication
oauth.frontend-url=http://localhost:3000

# Google OAuth Configuration (values loaded from Vault by OAuthVaultConfig)
oauth.providers.google.redirect-uri=${AUTH_GOOGLE_REDIRECT_URI:http://localhost:8080/auth/oauth/google/signin/callback}
oauth.providers.google.auth-url=${AUTH_GOOGLE_AUTH_URL:https://accounts.google.com/o/oauth2/auth}
oauth.providers.google.token-url=${AUTH_GOOGLE_TOKEN_URL:https://oauth2.googleapis.com/token}
oauth.providers.google.user-info-url=${AUTH_GOOGLE_USER_INFO_URL:https://www.googleapis.com/oauth2/v3/userinfo}
oauth.providers.google.scope=${AUTH_GOOGLE_SCOPE:email profile openid}

# Facebook OAuth Configuration (values loaded from Vault by OAuthVaultConfig)
oauth.providers.facebook.redirect-uri=${AUTH_FACEBOOK_REDIRECT_URI:http://localhost:8080/auth/oauth/facebook/callback}
oauth.providers.facebook.auth-url=${AUTH_FACEBOOK_AUTH_URL:https://www.facebook.com/v12.0/dialog/oauth}
oauth.providers.facebook.token-url=${AUTH_FACEBOOK_TOKEN_URL:https://graph.facebook.com/v12.0/oauth/access_token}
oauth.providers.facebook.user-info-url=${AUTH_FACEBOOK_USER_INFO_URL:https://graph.facebook.com/me}
oauth.providers.facebook.scope=${AUTH_FACEBOOK_SCOPE:email,public_profile}

# CORS configuration
strategiz.cors.allowed-origins=http://localhost:3000,http://localhost:8080,https://strategiz.io

# ====================================================
# Provider OAuth Configuration (for service-provider module)
# ====================================================
# Used for connecting user accounts to external providers

# Kraken OAuth Configuration
oauth.providers.kraken.client-id=${PROVIDER_KRAKEN_CLIENT_ID:}
oauth.providers.kraken.client-secret=${PROVIDER_KRAKEN_CLIENT_SECRET:}
oauth.providers.kraken.redirect-uri=http://localhost:8080/api/v1/provider/callback/kraken

# Coinbase OAuth Configuration (for provider connections)
# Loaded from Vault by ProviderVaultConfig
oauth.providers.coinbase.client-id=${PROVIDER_COINBASE_CLIENT_ID:}
oauth.providers.coinbase.client-secret=${PROVIDER_COINBASE_CLIENT_SECRET:}
oauth.providers.coinbase.redirect-uri=${PROVIDER_COINBASE_REDIRECT_URI:http://localhost:8080/v1/providers/callback/cb}
oauth.providers.coinbase.auth-url=${PROVIDER_COINBASE_AUTH_URL:https://www.coinbase.com/oauth/authorize}
oauth.providers.coinbase.scope=${PROVIDER_COINBASE_SCOPE:wallet:accounts:read,wallet:transactions:read,wallet:buys:read,wallet:sells:read}

# Alpaca OAuth Configuration (for provider connections)
oauth.providers.alpaca.client-id=${PROVIDER_ALPACA_CLIENT_ID:your-alpaca-client-id}
oauth.providers.alpaca.client-secret=${PROVIDER_ALPACA_CLIENT_SECRET:your-alpaca-client-secret}
oauth.providers.alpaca.redirect-uri=${PROVIDER_ALPACA_REDIRECT_URI:http://localhost:3000/auth/providers/alpaca/callback}
oauth.providers.alpaca.auth-url=${PROVIDER_ALPACA_AUTH_URL:https://app.alpaca.markets/oauth/authorize}
oauth.providers.alpaca.token-url=${PROVIDER_ALPACA_TOKEN_URL:https://api.alpaca.markets/oauth/token}
oauth.providers.alpaca.api-url=${PROVIDER_ALPACA_API_URL:https://api.alpaca.markets}
oauth.providers.alpaca.scope=${PROVIDER_ALPACA_SCOPE:account:read trading:write data:read}

# Charles Schwab OAuth Configuration (for provider connections)
oauth.providers.schwab.client-id=${PROVIDER_SCHWAB_CLIENT_ID:}
oauth.providers.schwab.client-secret=${PROVIDER_SCHWAB_CLIENT_SECRET:}
oauth.providers.schwab.redirect-uri=${PROVIDER_SCHWAB_REDIRECT_URI:https://127.0.0.1:8443/v1/providers/callback/schwab}
oauth.providers.schwab.auth-url=${PROVIDER_SCHWAB_AUTH_URL:https://api.schwabapi.com/v1/oauth/authorize}
oauth.providers.schwab.token-url=${PROVIDER_SCHWAB_TOKEN_URL:https://api.schwabapi.com/v1/oauth/token}
oauth.providers.schwab.api-url=${PROVIDER_SCHWAB_API_URL:https://api.schwabapi.com}
oauth.providers.schwab.scope=${PROVIDER_SCHWAB_SCOPE:readonly}

# Etherscan API key (replace with your real key)
etherscan.api.key=YOUR_ETHERSCAN_API_KEY_HERE

# Actuator Configuration
management.endpoints.web.exposure.include=health,info,prometheus,metrics,env,loggers
management.endpoint.health.show-details=always
management.endpoint.health.show-components=always
management.endpoints.web.base-path=/actuator
management.endpoint.prometheus.enabled=true
management.metrics.export.prometheus.enabled=true
management.metrics.tags.application=strategiz-core

# Enable more detailed metrics
management.metrics.distribution.percentiles-histogram.http.server.requests=true
management.metrics.distribution.slo.http.server.requests=50ms, 100ms, 200ms, 500ms, 1s

# Web client metrics (for exchange API calls)
management.metrics.web.client.request.autotime.enabled=true

# ====================================================
# Vault Configuration
# ====================================================
# Vault connection settings
spring.cloud.vault.uri=http://localhost:8200
spring.cloud.vault.token=${VAULT_TOKEN:myroot}
spring.cloud.vault.kv.enabled=true
spring.cloud.vault.kv.backend=secret
spring.cloud.vault.kv.default-context=strategiz

# Vault Configuration
# IMPORTANT: Set VAULT_TOKEN environment variable before running
# Local dev: export VAULT_TOKEN=root (or your dev token)
# Production: export VAULT_TOKEN=<production-token>
strategiz.vault.enabled=true
strategiz.vault.address=${VAULT_ADDR:http://localhost:8200}
strategiz.vault.secrets-path=secret
strategiz.vault.fail-fast=false
strategiz.vault.fallback-to-properties=true

# Spring Cloud Vault Configuration
spring.cloud.vault.authentication=TOKEN
spring.cloud.vault.uri=${VAULT_ADDR:http://localhost:8200}
spring.cloud.vault.token=${VAULT_TOKEN:}

# SpringDoc OpenAPI Configuration
springdoc.api-docs.path=/v3/api-docs
springdoc.swagger-ui.path=/swagger-ui.html
springdoc.swagger-ui.operations-sorter=alpha
springdoc.swagger-ui.tags-sorter=alpha
springdoc.swagger-ui.display-request-duration=true
springdoc.swagger-ui.try-it-out-enabled=true
springdoc.packagesToScan=io.strategiz
springdoc.pathsToMatch=/v1/**

# Passkey Configuration
passkey.rpId=localhost
passkey.rpName=Strategiz
passkey.challengeTimeoutMs=60000

# Session Management Configuration
session.expiry.seconds=86400
session.management.enabled=true
# Session cleanup retention policies (industry standard)
# Only delete sessions that are ALREADY expired/revoked AND older than these periods
session.cleanup.expired.days=7
session.cleanup.revoked.days=1

# ====================================================
# Authorization Framework Configuration
# ====================================================
strategiz.authorization.enabled=true
# Paths to skip authentication (in addition to defaults)
# Default skip paths: /actuator/**, /v3/api-docs/**, /swagger-ui/**, /v1/auth/**, /health, /info
# strategiz.authorization.skip-paths=/custom/public/**

# Enable debug logging for auth module
logging.level.dev.strategiz.service.auth=DEBUG
logging.level.io.strategiz.service.auth=DEBUG
logging.level.io.strategiz.service.auth.service.passkey=DEBUG
logging.level.io.strategiz.service.auth.controller.passkey=DEBUG

# Enable Spring MVC debug logging to diagnose endpoint mapping
logging.level.org.springframework.web=DEBUG
logging.level.org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping=TRACE
logging.level.org.springframework.web.servlet.handler=TRACE

# Spring MVC configuration to properly handle API requests
spring.mvc.throw-exception-if-no-handler-found=true
# Enable resource mappings but configure properly for API
spring.web.resources.add-mappings=true
# Disable static resource handling for our API paths
spring.mvc.static-path-pattern=/static/**

EOF < /dev/null